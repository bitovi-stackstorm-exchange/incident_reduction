version: 1.0

description: Receiver for alerts

input:
  - trigger_data

vars:
  - implemented_types:
      - "4xx"
      - "5xx"
      - "3xx"
      - "AAA"

tasks:
  route:
    action: core.noop
    next:
      - when: <% ctx().trigger_data.type = "4xx" %>
        do: handle_4xx
      - when: <% ctx().trigger_data.type = "5xx" %>
        do: handle_5xx
      - when: <% ctx().trigger_data.type = "3xx" %>
        do: handle_3xx
      - when: <% ctx().trigger_data.type = "AAA" %>
        do: handle_aaa

        # handle not found
      - when: <% succeeded() and not ctx().implemented_types.contains(ctx().trigger_data.type) %>
        do: notify_not_found


  handle_4xx:
    action: incident_reduction.handle-alert-4xx
    input:
      alert_data: <% ctx().trigger_data %>

  handle_5xx:
    # TODO: create incident_reduction.handle_5xx action
    action: core.echo message="call incident_reduction.handle_5xx pack" 
    input:
      alert_data: <% ctx().trigger_data %>

  handle_3xx:
    # TODO: create incident_reduction.handle_3xx action
    action: core.echo message="call incident_reduction.handle_3xx pack" 
    input:
      alert_data: <% ctx().trigger_data %>

  handle_aaa:
    # TODO: create remediation pack and remediation.handle_aaa_alert action
    action: core.echo message="call remediation.handle_aaa_alert pack" 
    input:
      alert_data: <% ctx().trigger_data %>


  notify_not_found:
    action: core.echo message="Trigger type not found"